<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EduMateAI - Smart Tutor</title>
<style>
/* ===== Body & Live Background ===== */
body {
  margin:0; padding:0; font-family:'Arial', sans-serif; height:100vh;
  color:#fff; overflow:hidden; display:flex; flex-direction:column; transition: background 0.5s;
  background: linear-gradient(270deg,#0f2027,#203a43,#2c5364);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
}
body.day {
  background: linear-gradient(270deg,#a1c4fd,#c2e9fb);
  color:#000;
}
@keyframes gradientBG { 
  0%{background-position:0% 50%;} 
  50%{background-position:100% 50%;} 
  100%{background-position:0% 50%;} 
}

/* Floating dots */
.dot {
  position: absolute;
  background: rgba(255,255,255,0.6);
  border-radius: 50%;
  pointer-events: none;
  animation: floatDots linear infinite;
}
@keyframes floatDots {
  0% { transform: translateY(0) translateX(0); opacity: 0.5; }
  50% { transform: translateY(-20px) translateX(15px); opacity: 1; }
  100% { transform: translateY(0) translateX(0); opacity: 0.5; }
}

/* Day/Night Toggle */
#toggleContainer { position: fixed; top:20px; right:20px; display:flex; align-items:center; gap:10px; z-index:1000; font-size:14px; user-select:none; }
.toggle-switch { position: relative; width:50px; height:24px; }
.toggle-switch input { display:none; }
.slider { position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background:#ccc; border-radius:24px; transition:0.4s; }
.slider:before { position:absolute; content:""; height:20px; width:20px; left:2px; bottom:2px; background:white; border-radius:50%; transition:0.4s; }
input:checked + .slider { background:#2196F3; }
input:checked + .slider:before { transform:translateX(26px); }

/* Landing Typing */
#aiTypingSection { flex:1; display:flex; justify-content:center; align-items:center; text-align:center;
padding:20px; font-size:22px; font-weight:bold; line-height:1.4; text-shadow:1px 1px 10px rgba(0,0,0,0.6); }

/* Results Section */
#resultsSection {
  display:none;
  flex-direction:column;
  gap:15px;
  width:90%;
  max-width:600px;
  margin:0 auto;
  animation: fadeIn 0.6s;
  max-height: 70vh;
  overflow-y: auto;
}
.section { padding:15px 20px; border-radius:12px; background:#1c1c1c; color:#fff; box-shadow:0 4px 15px rgba(0,0,0,0.3); transition: transform 0.3s; }
.section:hover { transform: translateY(-5px); }
#videosContainer { display:flex; overflow-x:auto; gap:10px; padding-bottom:5px; }
#videosContainer div { transition: transform 0.3s; cursor:pointer; }
#videosContainer div:hover { transform: scale(1.05); }

/* Scrollbar for results */
#resultsSection::-webkit-scrollbar { width:8px; }
#resultsSection::-webkit-scrollbar-thumb { background:#555; border-radius:4px; }

/* Search */
#searchContainer { position:fixed; bottom:20px; width:90%; max-width:600px; display:flex; gap:10px; }
#searchInput { flex:1; padding:12px 15px; font-size:16px; border:1px solid #555; border-radius:24px; outline:none; background:#222; color:#fff; }
body.day #searchInput { background:#fff; color:#000; border:1px solid #ccc; }
#searchBtn, #newSearchBtn { padding:12px 20px; border:none; background:#1fa2ff; color:#fff; font-weight:bold; font-size:16px; cursor:pointer; border-radius:24px; transition: all 0.3s ease; box-shadow:0 4px 12px rgba(0,0,0,0.2); }
#searchBtn:hover, #newSearchBtn:hover { background:#12d8fa; transform: translateY(-2px); }

@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

/* AI Atom Icon */
.ai-icon { width: 45px; height: 45px; background: #4a148c; border-radius: 10px; margin: 10px auto; display: flex; justify-content: center; align-items: center; animation: pulse 1.5s infinite ease-in-out; }
@keyframes pulse { 0% { transform: scale(1); background:#4a148c; } 50% { transform: scale(1.12); background:#7b1fa2; } 100% { transform: scale(1); background:#4a148c; } }
.atom { width: 28px; height: 28px; border: 2px solid white; border-radius: 50%; position: relative; }
.atom::before { content: ""; width: 8px; height: 8px; background: white; border-radius: 50%; position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); }
.electron { width: 6px; height: 6px; background: #ff4081; border-radius: 50%; position: absolute; right: -5px; top: 50%; transform: translateY(-50%); animation: orbit 1.4s linear infinite; }
@keyframes orbit { 0% { transform: rotate(0deg) translateX(14px); } 100% { transform: rotate(360deg) translateX(14px); } }
</style>
</head>
<body class="night">

<div id="dotsContainer"></div>

<div id="toggleContainer">
  <span>ðŸŒž/ðŸŒ™</span>
  <label class="toggle-switch">
    <input type="checkbox" id="dayNightToggle" checked>
    <span class="slider"></span>
  </label>
</div>

<div id="aiTypingSection"><span id="typingText"></span></div>

<main id="resultsSection">
  <div class="section" id="responseBox">
    <h2>AI Response</h2>
    <div id="aiAnswer">
      <div id="aiThinking" style="text-align:center; margin-top:10px;">
        <p>AI is thinking...</p>
        <p style="opacity:0.6; font-size:14px;">Just wait a sec...</p>
        <div class="ai-icon"><div class="atom"><div class="electron"></div></div></div>
      </div>
    </div>
  </div>

  <div class="section" id="videoList">
    <h2>Explanation Videos</h2>
    <div id="videosContainer"></div>
  </div>

  <button id="newSearchBtn">New Search</button>
</main>

<div id="searchContainer">
  <input type="text" id="searchInput" placeholder="Type your work here...">
  <button id="searchBtn">Send</button>
</div>

<script>
// Elements
const searchInput=document.getElementById('searchInput');
const searchBtn=document.getElementById('searchBtn');
const resultsSection=document.getElementById('resultsSection');
const aiAnswer=document.getElementById('aiAnswer');
const videosContainer=document.getElementById('videosContainer');
const aiTypingSection=document.getElementById('aiTypingSection');
const searchContainer=document.getElementById('searchContainer');
const newSearchBtn=document.getElementById('newSearchBtn');
const dayNightToggle=document.getElementById('dayNightToggle');
const body=document.body;
const typingText=document.getElementById('typingText');
const dotsContainer=document.getElementById('dotsContainer');

// Floating dots
for(let i=0;i<30;i++){
  const dot=document.createElement('div'); dot.className='dot';
  const size=Math.random()*4+2; dot.style.width=size+'px'; dot.style.height=size+'px';
  dot.style.top=Math.random()*100+'%'; dot.style.left=Math.random()*100+'%';
  dot.style.animationDuration=(Math.random()*10+5)+'s';
  dotsContainer.appendChild(dot);
}

// Label long AI response
function labelLongResponse(text){
  const lines=text.split(/\n|\. /).filter(Boolean);
  return lines.map((l,i)=>`${i+1}. ${l.trim()}`).join('\n');
}

// Display AI response
function displayAIResponse(text){
  document.getElementById("aiThinking").style.display="none";
  aiAnswer.innerHTML='';
  text.split('\n').forEach(line=>{
    const p=document.createElement('p'); p.textContent=line;
    aiAnswer.appendChild(p);
  });
}

// Display YouTube videos
function displayVideos(items){
  videosContainer.innerHTML='';
  if(!items || items.length===0){ videosContainer.textContent="No videos found / quota exceeded."; return; }
  items.forEach(video=>{
    const div=document.createElement('div'); div.style.minWidth='250px'; div.style.marginRight='10px';
    div.onclick=()=>window.open(`https://www.youtube.com/watch?v=${video.id.videoId}`,"_blank");
    div.innerHTML=`<img src="${video.snippet.thumbnails.medium.url}" style="width:100%;border-radius:5px;">
    <p style="font-size:14px;margin:5px 0 0 0;">${video.snippet.title}</p>`;
    videosContainer.appendChild(div);
  });
}

// Day/Night toggle
dayNightToggle.addEventListener('change', ()=>{
  body.className=dayNightToggle.checked ? 'night':'day';
});

// Landing typing animation
const phrases=["Hello! ðŸ¤— I am your Smart Tutor.","I can explain your work, answer questions, and provide helpful videos...","Type your question below and let's get started!"];
let phraseIndex=0,charIndex=0,deleting=false;
function typeLanding(){
  const current=phrases[phraseIndex];
  if(!deleting){ typingText.textContent=current.slice(0,charIndex+1); charIndex++;
    if(charIndex===current.length){ deleting=true; setTimeout(typeLanding,1500); return; }
  } else { typingText.textContent=current.slice(0,charIndex-1); charIndex--;
    if(charIndex===0){ deleting=false; phraseIndex=(phraseIndex+1)%phrases.length; }
  }
  setTimeout(typeLanding,deleting?50:100);
}
typeLanding();

// Fetch API
searchBtn.addEventListener('click', async ()=>{
  const query=searchInput.value.trim(); if(!query) return;
  aiTypingSection.style.display='none'; searchContainer.style.display='none'; resultsSection.style.display='flex';
  document.getElementById("aiThinking").style.display="block";

  let dots=0; const anim=setInterval(()=>{ dots=(dots+1)%4; document.querySelector("#aiThinking p").textContent="AI is thinking"+ ".".repeat(dots); },500);

  try{
    const resp=await fetch(`/api/getData?q=${encodeURIComponent(query)}`);
    const data=await resp.json();
    clearInterval(anim);
    const aiText=data.ai_response?.choices?.[0]?.message?.content || "No response";
    displayAIResponse(labelLongResponse(aiText));
    displayVideos(data.youtube_videos?.items);
  } catch(err){ clearInterval(anim); displayAIResponse("Failed to load data."); console.error(err);}
});

// New Search
newSearchBtn.addEventListener('click', ()=>{
  resultsSection.style.display='none'; searchContainer.style.display='flex'; aiTypingSection.style.display='flex';
  searchInput.value=''; aiAnswer.innerHTML=''; videosContainer.innerHTML=''; document.getElementById("aiThinking").style.display="block";
});
</script>
</body>
                            </html>
